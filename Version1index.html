<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BanhomDev Logistics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/png" href="https://yt3.ggpht.com/hwhkHWWiLoru-CSsqJjevgGzThs5wtRq-hyL5MDMPqQmVXXwMFLuhPXqcSITyHled3tDBycIhQ=s88-c-k-c0x00ffffff-no-rj">

<link rel="apple-touch-icon" href="https://yt3.ggpht.com/hwhkHWWiLoru-CSsqJjevgGzThs5wtRq-hyL5MDMPqQmVXXwMFLuhPXqcSITyHled3tDBycIhQ=s180-c-k-c0x00ffffff-no-rj">
    <style>
      
      
        body { font-family: 'Noto Sans Lao', sans-serif !important;; background-color: #f8fafc; }
        .hidden-el { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .loader-ring {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

          /* Custom SweetAlert Styles */
        .swal2-popup {
            border-radius: 2rem !important;
            padding: 2rem !important;
        }
        .swal2-title {
            font-family: 'Noto Sans Lao', sans-serif !important;
            font-weight: 600 !important;
        }
        .swal2-confirm {
            border-radius: 1rem !important;
            padding: 0.8rem 2rem !important;
            font-weight: 500 !important;
        }
        .swal2-cancel {
            border-radius: 1rem !important;
            padding: 0.8rem 2rem !important;
        }




 
        /* กล่องควบคุมความสูงและขอบมน */
    .slider-container { 
        width: 100%; 
        height: 220px; 
        position: relative; 
        overflow: hidden; 
        border-radius: 2rem; 
        background-color: #e2e8f0; 
    }

    /* แถบสำหรับวางรูปเรียงกัน และตั้งค่าแอนิเมชันการเลื่อน */
    .slider-track { 
        display: flex; 
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
        height: 100%; 
        width: 100%; 
    }

    /* จัดขนาดรูปแต่ละใบให้เต็มพื้นที่ */
    .slider-item { 
        min-width: 100%; 
        height: 100%; 
        position: relative; 
    }

    .slider-item img { 
        width: 100%; 
        height: 100%; 
        object-fit: cover; /* บังคับให้รูปเต็มกรอบโดยไม่เสียสัดส่วน */
    }

        /* กล่องควบคุมความสูงและขอบมน */



        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .tab-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .status-badge-active { background-color: #3b82f6 !important; color: white !important; }
        .detail-img-container { width: 100%; height: auto; max-height: 700px; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-24">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-black/50 hidden-el">
        <div class="bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center">
            <div class="loader-ring mb-4"></div>
            <p id="progressLabel" class="text-blue-600 font-bold text-2xl">0%</p>
            <p class="text-gray-500 text-sm mt-2">ກຳລັງໂຫຼດ...</p>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-6">
        <div class="w-full max-w-md bg-white rounded-[2rem] shadow-xl p-8 text-center border border-gray-100">
            <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-blue-200">
                <img src="data:image/jpeg;base64,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" alt="Logo" class="w-full h-full object-cover rounded-full">
            </div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">ລະບົບຕິດຕາມເຄື່ອງ</h1>
            <p class="text-gray-400 mb-8 text-sm"> BanhomDev ຮັບສັ່ງເຄື່ອງ</p>

            
            
            <div class="space-y-4">
                <div class="relative">
                    <input type="text" id="loginPhone" maxlength="8" placeholder="ເບີໂທ 8 ໂຕເລກ" 
                           class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    <i class="fas fa-mobile-alt absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <div class="relative">
                    <input type="password" id="loginPassword" placeholder="ລະຫັດຜ່ານ" 
                           class="w-full pl-12 pr-12 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <button onclick="togglePassword('loginPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-blue-500">
                        <i class="fas fa-eye" id="eyeIcon"></i>
                    </button>
                </div>
                <button onclick="handleLogin()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-semibold text-lg hover:bg-blue-700 transition-all shadow-lg active:scale-[0.98]">
                    ເຂົ້າສູ່ລະບົບ
                </button>
            <p class="text-gray-400 mb-8 text-sm">  ມີລະບົບຈົດຈຳເຂົ້າລະບົບ 15 ວັນ </p>

            </div>
        </div>
    </div>
  <!-- Mandatory Password Change Page -->
    <div id="newPasswordPage" class="min-h-screen flex items-center justify-center p-6 hidden-el">
        <div class="w-full max-w-md bg-white rounded-[2rem] shadow-xl p-8 text-center">
            <i class="fas fa-shield-halved text-5xl text-blue-500 mb-4"></i>
            <h2 class="text-xl font-bold mb-2">ຕັ້ງລະຫັດຜ່ານໃໝ່</h2>
            <p class="text-gray-500 text-sm mb-6">ເພື່ອຄວາມປອດໄພໃນການຮັບບິນ, ທ່ານຈຳເປັນຕ້ອງປ່ຽນລະຫັດເຂົ້າລະບົບຄັ້ງແລກ ເພື່ອບໍ່ໃຫ້ຄືກັບຄົນອື່ນ <strong>(ລະຫັດຜ່ານຢ່າງນ້ອຍ 5 ຕົວເລກ ແລະ ບໍ່ສາມາດໃສ່ເລກລຽງກັນໄດ້ ເຊັ່ນ 12345)</strong></p>
            <div class="space-y-4">
                <input type="password" id="newPass1" placeholder="ລະຫັດຜ່ານໃໝ່" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-500">
                <input type="password" id="newPass2" placeholder="ຢືນຢັນລະຫັດຜ່ານໃໝ່" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="confirmNewPassword()" class="w-full py-4 bg-green-600 text-white rounded-2xl font-bold shadow-lg">ຢືນຢັນປ່ຽນລະຫັດ</button>
            </div>
        </div>
    </div>
    
    <!-- App Main UI -->
    <div id="mainUI" class="hidden-el">
        <!-- Header -->
        <header class="fixed top-0 left-0 right-0 h-16 bg-white shadow-sm flex items-center justify-between px-6 z-50">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-blue-600 rounded-full flex items-center justify-center shadow-md shadow-blue-100">
                                   <img src="data:image/jpeg;base64,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" alt="Logo" class="w-full h-full object-cover rounded-full">

                </div>
                <span class="font-bold text-gray-800 text-lg tracking-tight">BanhomDev ຮັບສັ່ງເຄື່ອງ</span>
            </div>
            <button onclick="refreshData()" class="w-10 h-10 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-full transition-colors">
                <i class="fas fa-rotate text-xl"></i>
            </button>
        </header>

        <!-- Content -->
        <main class="pt-20 px-4 pb-24">
            <!-- Tab: Home -->
            <section id="tab-home" class="tab-content">
                <!-- Image Slider -->
                   <div class="slider-container mb-8 shadow-xl">
                      
                          <div id="photoSlider" class="slider-track"></div>
                          
                        
                          <div id="sliderDots" class="absolute bottom-4 left-0 right-0 flex justify-center gap-1.5 z-10"></div>
                      </div>

                <!-- Stats Blocks -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div onclick="switchTab('thailao')" class="bg-gradient-to-br from-blue-600 to-blue-700 p-5 rounded-3xl text-white shadow-lg shadow-blue-100">
                        <p class="text-xs font-light opacity-80 mb-1">ລາຍການ ໄທ-ລາວ</p>
                        <h3 id="statThai" class="text-2xl font-bold">0 ລາຍການ</h3>
                    </div>
                    <div onclick="switchTab('chinalao')" class="bg-gradient-to-br from-indigo-600 to-indigo-700 p-5 rounded-3xl text-white shadow-lg shadow-indigo-100">
                        <p class="text-xs font-light opacity-80 mb-1">ລາຍການ ຈີນ-ລາວ</p>
                        <h3 id="statChina" class="text-2xl font-bold">0 ລາຍການ</h3>
                    </div>
                </div>

                <!-- Grid Menu -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="switchTab('thailao')" class="p-6 bg-white rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center gap-3 active:scale-95 transition-transform">
                        <div class="w-12 h-12 bg-blue-50 text-blue-500 rounded-2xl flex items-center justify-center text-xl">
                            <img src="https://images.rawpixel.com/image_png_social_landscape/cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDIyLTA1L2pvYjkzNy04MC5wbmc.png" alt="Thai Flag" class="w-full h-full object-cover rounded-2xl">
                        </div>
                        <span class="text-sm font-semibold text-gray-700">ໄທ-ລາວ</span>
                    </button>
                    <button onclick="switchTab('chinalao')" class="p-6 bg-white rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center gap-3 active:scale-95 transition-transform">
                        <div class="w-12 h-12 bg-indigo-50 text-indigo-500 rounded-2xl flex items-center justify-center text-xl">
               <img src="https://i.etsystatic.com/25240952/r/il/0ec8c0/2891544897/il_fullxfull.2891544897_tli0.jpg" alt="Thai Flag" class="w-full h-full object-cover rounded-2xl">

                        </div>
                        <span class="text-sm font-semibold text-gray-700">ຈີນ-ລາວ</span>
                    </button>
                    <button onclick="window.open('https://www.youtube.com/@BanhomDev', '_blank')" class="p-6 bg-white rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center gap-3 active:scale-95 transition-transform">
    <div class="w-12 h-12 bg-red-50 text-red-600 rounded-2xl flex items-center justify-center text-2xl">
        <i class="fab fa-youtube"></i>
    </div>
    <span class="text-sm font-semibold text-gray-700">Youtube</span>
</button>
                    <button onclick="openChangePassModal()" class="p-6 bg-white rounded-3xl shadow-sm border border-gray-100 flex flex-col items-center gap-3 active:scale-95 transition-transform">
                        <div class="w-12 h-12 bg-orange-50 text-orange-500 rounded-2xl flex items-center justify-center text-xl">
                            <i class="fas fa-key"></i>
                        </div>
                        <span class="text-sm font-semibold text-gray-700">ປ່ຽນລະຫັດຜ່ານ</span>
                    </button>
                </div>
            </section>

            <!-- Tab: Logistics (Combined Thai/China) -->
            <section id="tab-logistics" class="tab-content hidden-el">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="logTitle" class="text-xl font-bold text-gray-800">ໄທ-ລາວ</h2>
                </div>
                
                <!-- Filter Badges -->
                <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2">
                    <button onclick="filterByStatus('ທັງໝົດ')" id="btn-all" class="status-btn px-4 py-2 bg-white text-gray-500 rounded-full text-xs font-semibold whitespace-nowrap shadow-sm border border-gray-100">ທັງໝົດ (0)</button>
                    <button onclick="filterByStatus('ກຳລັງຈັດສົ່ງ')" id="btn-ship" class="status-btn px-4 py-2 bg-white text-gray-500 rounded-full text-xs font-semibold whitespace-nowrap shadow-sm border border-gray-100">ກຳລັງຈັດສົ່ງ (0)</button>
                    <button onclick="filterByStatus('ຮອດປາຍທາງແລ້ວ')" id="btn-dest" class="status-btn px-4 py-2 bg-white text-gray-500 rounded-full text-xs font-semibold whitespace-nowrap shadow-sm border border-gray-100">ຮອດປາຍທາງແລ້ວ (0)</button>
                    <button onclick="filterByStatus('ສຳເລັດ')" id="btn-done" class="status-btn px-4 py-2 bg-white text-gray-500 rounded-full text-xs font-semibold whitespace-nowrap shadow-sm border border-gray-100">ສຳເລັດ (0)</button>
                </div>

                <!-- List Area -->
                <div id="logisticsList" class="space-y-4">
                    <!-- List items will be injected -->
                </div>
            </section>

            <!-- Tab: Profile -->
            <section id="tab-profile" class="tab-content hidden-el">
                <div class="bg-white rounded-[2rem] p-8 shadow-sm border border-gray-100 text-center mb-6">
                    <div class="w-24 h-24 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-white shadow-md">
                                       <img src="data:image/jpeg;base64,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" alt="Logo" class="w-full h-full object-cover rounded-full">

                    </div>
                    <h2 id="userNameDisplay" class="text-xl font-bold text-gray-800">Loading...</h2>
                    <p id="userPhoneDisplay" class="text-gray-400 text-sm mb-6">912XXXXX</p>
                    <button onclick="openEditNameModal()" class="px-8 py-2.5 bg-blue-50 text-blue-600 rounded-full font-semibold text-sm hover:bg-blue-100 transition-colors">
                        <i class="fas fa-edit mr-2"></i>ແກ້ໄຂຊື່
                    </button>
                </div>

                <div class="space-y-3">
                    <div onclick="openChangePassModal()" class="flex items-center justify-between p-5 bg-white rounded-3xl shadow-sm border border-gray-100 cursor-pointer">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-orange-50 text-orange-500 rounded-xl flex items-center justify-center"><i class="fas fa-lock-open"></i></div>
                            <span class="font-medium text-gray-700">ປ່ຽນລະຫັດຜ່ານ</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-300"></i>
                    </div>
                    <div onclick="confirmLogout()" class="flex items-center justify-between p-5 bg-white rounded-3xl shadow-sm border border-gray-100 cursor-pointer text-red-500">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-red-50 text-red-500 rounded-xl flex items-center justify-center"><i class="fas fa-power-off"></i></div>
                            <span class="font-medium">ອອກລະບົບ</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 h-20 bg-white/90 backdrop-blur-md border-t border-gray-100 flex items-center justify-between px-6 z-50">
            <button onclick="switchTab('home')" class="nav-item flex flex-col items-center gap-1 text-gray-400">
                <i class="fas fa-house text-xl"></i>
                <span class="text-[10px] font-medium">ໜ້າຫຼັກ</span>
            </button>
            <button onclick="switchTab('thailao')" class="nav-item flex flex-col items-center gap-1 text-gray-400">
               <i class="fas fa-truck text-xl "></i>
                <span class="text-[10px] font-medium">ໄທ-ລາວ</span>
            </button>
            <div class="relative -top-6">
                <button onclick="window.open('https://wa.me/8562091255129?text=ສະບາຍດີ ແອັດ', '_blank')" class="w-16 h-16 bg-blue-600 rounded-full shadow-lg shadow-blue-200 flex items-center justify-center text-white border-4 border-white active:scale-90 transition-transform">
                    <i class="fab fa-whatsapp text-2xl"></i>
                </button>
                <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold text-blue-600">24/7</span>
            </div>
            <button onclick="switchTab('chinalao')" class="nav-item flex flex-col items-center gap-1 text-gray-400">
                <i class="fas fa-plane text-xl "></i>
                <span class="text-[10px] font-medium">ຈີນ-ລາວ</span>
            </button>
            <button onclick="switchTab('profile')" class="nav-item flex flex-col items-center gap-1 text-gray-400">
                <i class="fas fa-user text-xl"></i>
                <span class="text-[10px] font-medium">ຕັ້ງຄ່າ</span>
            </button>
        </nav>
    </div>

 
    <!-- Modals -->
    <div id="detailModal" class="fixed inset-0 z-[60] bg-black/60 flex items-end sm:items-center justify-center hidden-el p-0 sm:p-4">
        <div class="bg-white w-full max-w-lg rounded-t-[2.5rem] sm:rounded-[2.5rem] max-h-[92vh] overflow-y-auto overflow-x-hidden shadow-2xl">
            <div class="sticky top-0 bg-white p-6 pb-2 z-10 flex justify-between items-center border-b border-gray-50">
                <h3 class="text-xl font-bold text-gray-800">ລາຍລະອຽດພັດສະດຸ</h3>
                <button onclick="closeModal('detailModal')" class="w-10 h-10 flex items-center justify-center bg-gray-50 text-gray-400 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div id="detailBody" class="p-6 pt-4 space-y-6">
                <!-- Detailed content injected here -->
            </div>
        </div>
    </div>

    <!-- Generic Input Modal -->
    <div id="inputModal" class="fixed inset-0 z-[70] bg-black/60 flex items-center justify-center p-6 hidden-el">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl">
            <h3 id="modalTitle" class="text-xl font-bold mb-4">Title</h3>
            <div id="modalContent" class="space-y-4"></div>
            <div class="flex gap-3 mt-8">
                <button onclick="closeModal('inputModal')" class="flex-1 py-4 bg-gray-50 text-gray-500 rounded-2xl font-bold">ຍົກເລີກ</button>
                <button id="modalConfirmBtn" class="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg">ບັນທຶກ</button>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="imgPreviewModal" class="fixed inset-0 z-[80] bg-black/95 flex items-center justify-center p-4 hidden-el">
        <button onclick="closeModal('imgPreviewModal')" class="absolute top-8 right-8 text-white text-3xl opacity-70 hover:opacity-100">
            <i class="fas fa-xmark"></i>
        </button>
        <img id="previewImgEl" src="" class="max-w-full max-h-full object-contain rounded-lg">
    </div>


    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby4n6AtlX6OBFGUrjQ2yh8Nfg6jk-ZmLNHsGZyblvAsQL18rJ5BEGopb_qdSL65PW3ZTA/exec";
        let user = null;
        let dataStore = { data1: [], data2: [], photos: [] };
        let activeSheet = 'data1';
        let currentStatus = 'all';
        let currentSlide = 0;

        window.onload = async () => {
            const saved = localStorage.getItem('banhom_session');
            if(saved) {
                user = JSON.parse(saved);
                document.getElementById('loginPage').classList.add('hidden-el');
                document.getElementById('mainUI').classList.remove('hidden-el');
                // updateProfileUI();
                // await refreshData();
                // switchTab('home');
                initApp();
            }
        };



        async function initApp() {
            document.getElementById('loginPage').classList.add('hidden-el');
            document.getElementById('mainUI').classList.remove('hidden-el');
            updateProfileUI();
            await refreshData(false);
            switchTab('home');
            // Auto Sync ข้อมูลทุก 10 วินาที
            setInterval(() => refreshData(true), 10000);
        }

        async function api(action, params = {}, showLoad = true) {
    if (showLoad) showLoading(true); // แสดงโหลดเฉพาะเมื่อต้องการ
    try {
        const qs = new URLSearchParams({ action, ...params }).toString();
        const res = await fetch(`${API_URL}?${qs}`);
        const json = await res.json();
        if (showLoad) showLoading(false);
        return json;
    } catch (e) {
        if (showLoad) showLoading(false);
        return null;
    }
}





        // async function api(action, params = {}) {
        //     try {
        //         const qs = new URLSearchParams({ action, ...params }).toString();
        //         const res = await fetch(`${API_URL}?${qs}`);
        //         return await res.json();
        //     } catch (e) { return null; }
        // }

        
       

          function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');

              if(show) {
                overlay.classList.remove('hidden-el');
                simulateProgress();
            } else {
                overlay.classList.add('hidden-el');
            }




            // if(show) overlay.classList.remove('hidden-el');
            // else overlay.classList.add('hidden-el');
        }
        





      async function initApp() {
    document.getElementById('loginPage').classList.add('hidden-el');
    document.getElementById('mainUI').classList.remove('hidden-el');
    updateProfileUI();
    
    // โหลดครั้งแรกให้แสดง Loading (ส่ง false)
    await refreshData(false);
    
    switchTab('home');

    // Auto Sync ทุก 10 วินาที ไม่ต้องแสดง Loading (ส่ง true)
    setInterval(() => refreshData(true), 10000); 
}
      


    async function refreshData(silent = false) {
    const result = await api('fetchAll', {}, !silent); 
    if(result) {
        dataStore = result;
        renderHome();
        if(!document.getElementById('tab-logistics').classList.contains('hidden-el')) {
            renderLogisticsList();
        }
    }
}

        async function handleLogin() {
            const phone = document.getElementById('loginPhone').value;
            const pass = document.getElementById('loginPassword').value;
            if(phone.length !== 8) return Swal.fire({
                title: "ກະລຸນາໃສ່ເບີໂທແລະລະຫັດຜ່ານ",
                text: "ເບີໂທຄວນໃສ່ 8 ຕົວເລກ",
                icon: "question",
                timer: 5000
});

            const res = await api('login', { phone, pass });
            if(res.status === 'success') {
                if(res.user.status === 'new') {
                    user = res.user;
                    document.getElementById('loginPage').classList.add('hidden-el');
                    document.getElementById('newPasswordPage').classList.remove('hidden-el');
                     initApp();
                } else {
                    completeLogin(res.user);
                }
            } else {
                // alert(res.message);
                  Swal.fire({
                  icon: "error",
                  title: "ເບີໂທຫຼືລະຫັດຜ່ານບໍ່ຖືກ",
                  text: "ກະລຸນາໃສ່ລະຫັດຜ່ານໃຫ້ຖືກຕ້ອງ",
                  });
            }
        }

      async function confirmNewPassword() {
    const p1 = document.getElementById('newPass1').value;
    const p2 = document.getElementById('newPass2').value;

    if(p1 === "" || p2 === "") return Swal.fire({
          icon: "error",
          title: "ບໍ່ທັນໃສ່ລະຫັດຜ່ານ",
          text: "ກະລຸນາໃສ່ລະຫັດຜ່ານກ່ອນເຂົ້າລະບົບ",
    });

    if(p1.length < 5) return Swal.fire({ // ປ່ຽນເປັນ 5 ຕາມທີ່ text ບອກ
          icon: "error",
          title: "ລະຫັດຜ່ານສັ້ນເກີນໄປ",
          text: "ກະລຸນາໃສ່ລະຫັດຜ່ານຢ່າງນ້ອຍ 5 ຕົວເລກ",
    });

    // --- ເພີ່ມສ່ວນກວດສອບເລກລຽງ ຫຼື ເລກຊ້ຳ ---
    const commonPatterns = ["12345", "123456", "12345678", "123456789", "012345", "54321", "00000", "11111"];
    if (commonPatterns.some(pattern => p1.includes(pattern))) {
        return Swal.fire({
            icon: "warning",
            title: "ລະຫັດຜ່ານເດົາງ່າຍເກີນໄປ",
            text: "ກະລຸນາຢ່າໃຊ້ເລກລຽງ ຫຼື ເລກຊ້ຳກັນ (ຕົວຢ່າງ: 12345)",
        });
    }
    // ------------------------------------

    if(p1 !== p2) return Swal.fire({
          icon: "error",
          title: "ລະຫັດຜ່ານບໍ່ຕົງກັນ",
          text: "ກະລຸນາໃສ່ລະຫັດຜ່ານຫ້ອງທີ 1 ແລະ 2 ໃຫ້ຄືກັນ",
    });

    const res = await api('updatePassword', { phone: user.phone, newPass: p1, isNew: 'true' });
    if(res.status === 'success') {
        user.status = 'Changed';
        completeLogin(user);
    }
}


        function completeLogin(userData) {
            user = userData;
            localStorage.setItem('banhom_session', JSON.stringify(user));
            document.getElementById('loginPage').classList.add('hidden-el');
            document.getElementById('newPasswordPage').classList.add('hidden-el');
            document.getElementById('mainUI').classList.remove('hidden-el');
            updateProfileUI();
            refreshData();
            api('logLogin', { phone: user.phone });

        }

        function logout() {
        

            localStorage.removeItem('banhom_session');
            location.reload();
        }


         async function openUpdateName() {
    // 1. ตรวจสอบว่า Login หรือยัง
    if (!user || !user.phone) {
        return Swal.fire('ກະລຸນາເຂົ້າສູ່ລະບົບ', '', 'error');
    }

    // 2. แสดง SweetAlert2 พร้อมช่องกรอกข้อความ (Input)
    const { value: newName } = await Swal.fire({
        title: 'ແກ້ໄຂຊື່ຜູ້ໃຊ້ງານ',
        input: 'text',
        inputLabel: 'ກະລຸນາເພີ່ມຊື້ໃໝ່ຂອງທ່ານ',
        inputValue: user.name || '', // แสดงชื่อปัจจุบันเป็นค่าเริ่มต้น
        showCancelButton: true,
        confirmButtonText: 'บບັກທຶກ',
        cancelButtonText: 'ຍົກເລີກ',
        inputPlaceholder: 'ຕົວຢ່າງ: BanhomDev',
        confirmButtonColor: '#2563eb',
        customClass: {
            popup: 'rounded-[2rem]',
            input: 'rounded-xl'
        },
        inputValidator: (value) => {
            if (!value) return 'ກະລຸນາໃສ່ຊື່ກ່ອນບັນທຶກ!';
            if (value.length < 2) return 'ຊື່ສັ້ນເກີນໄປ!';
        }
    });

    // 3. หากผู้ใช้กดบันทึก (มีค่า newName ส่งมา)
    if (newName) {
        try {
            // แสดง Loading ระหว่างรอ Server
            document.getElementById('loadingOverlay').classList.remove('hidden-el');

            // ส่งข้อมูลไปที่ Google Apps Script (Action: updateProfile)
            const qs = new URLSearchParams({
                action: 'updateProfile',
                phone: user.phone,
                newName: newName.trim()
            }).toString();

            const res = await fetch(`${API_URL}?${qs}`);
            const result = await res.json();

            document.getElementById('loadingOverlay').classList.add('hidden-el');

            if (result.status === 'success') {
                // อัปเดตข้อมูลในเครื่อง (LocalStorage & Variable)
                user = result.user;
                localStorage.setItem('banhom_session', JSON.stringify(user));
                
                // อัปเดต UI หน้าจอ
                updateProfileUI(); 

                // แจ้งเตือนสำเร็จ
                    MySwal.fire({
                        icon: 'success',
                        title: 'ແກ້ໄຂສຳເລັດ',
                        text: 'ຊື່ຜູ້ໃຊ້ຖືກປ່ຽນແປງຮຽບຮ້ອຍ',
                        timer: 2500,
                        showConfirmButton: false
                    });
                } else {
                    MySwal.fire('ບໍ່ສຳເລັດ', 'ບໍ່ສາມາດແກ້ໄຂຂໍ້ມູນໄດ້ຕອນນີ້', 'error');
                }
        } catch (error) {
            document.getElementById('loadingOverlay').classList.add('hidden-el');
            Swal.fire('ເກີດຂໍ້ຜິດພາດ', 'ບໍ່ສາມາດເຊື່ອມຕໍ່ Server ໄດ້', 'error');
        }
    }
}






async function openUpdatePass() {
    // 1. ตรวจสอบว่าล็อกอินหรือยัง
    if (!user || !user.phone) {
        return Swal.fire('ກະລຸນາເຂົ້າສູ່ລະບົບ', '', 'error');
    }

    // 2. เปิด Popup รับค่ารหัสผ่านใหม่
    const { value: newPassword } = await Swal.fire({
        title: 'ປ່ຽນລະຫັດຜ່ານໃໝ່!',
        input: 'password',
        inputLabel: 'ກະລຸນາໃສ່ລະຫັດຜ່ານທີ່ຕ້ອງການ',
        inputPlaceholder: 'ລະຫັດຜ່ານຢ່າງນ້ອຍ 4 ຕົວເລກ',
        showCancelButton: true,
        confirmButtonText: 'ຢືນຢັນປ່ຽນ',
        cancelButtonText: 'ຍົກເລີກ',
        confirmButtonColor: '#2563eb', // สีน้ำเงิน
        inputAttributes: {
            autocapitalize: 'off',
            autocorrect: 'off'
        },
        customClass: {
            popup: 'rounded-[2.5rem]',
            confirmButton: 'rounded-xl px-8 py-3',
            cancelButton: 'rounded-xl px-8 py-3'
        },
        // ตรวจสอบความถูกต้องเบื้องต้นก่อนส่ง
        inputValidator: (value) => {
            if (!value) return 'ຍັງບໍ່ທັນໃສ່ຂໍ້ມູນລະຫັດຜ່ານ';
            if (value.length < 4) return 'ລະຫັດຜ່ານຕ້ອງມີຢ່າງນ້ອຍ 4 ຕົວ';
        }
    });

    // 3. หากผู้ใช้กรอกข้อมูลและกดยืนยัน
    if (newPassword) {
        // แสดง Loading ขณะบันทึก
        document.getElementById('loadingOverlay').classList.remove('hidden-el');

        try {
            // ส่งข้อมูลไปที่ Google Apps Script
            const params = new URLSearchParams({
                action: 'updateProfile',
                phone: user.phone,
                newPass: newPassword
            }).toString();

            const response = await fetch(`${API_URL}?${params}`);
            const result = await response.json();

            document.getElementById('loadingOverlay').classList.add('hidden-el');

            if (result.status === 'success') {
                // อัปเดตข้อมูลในเครื่อง (LocalStorage)
                user.password = newPassword;
                localStorage.setItem('banhom_session', JSON.stringify(user));

                Swal.fire({
                    icon: 'success',
                    title: 'ປ່ຽນລະຫັດສຳເລັດ!',
                    text: 'ກະລຸນາຈື່ລະຫັດຜ່ານໃໝ່ຂອງທ່ານເພື່ອ Login ຄັ້ງຕໍ່ໄປ',
                    timer: 3000,
                    showConfirmButton: false
                });
            } else {
                Swal.fire('ເີກດຂໍ້ຜິດພາດ', result.message || 'ບໍ່ສາມາດເຊື່ອມຕໍ່ Server ໄດ້', 'error');
            }
        } catch (error) {
            document.getElementById('loadingOverlay').classList.add('hidden-el');
            Swal.fire('Error', 'ບໍ່ສາມາດເຊື່ອມຕໍ່ Server ໄດ້', 'error');
        }
    }
}



        







        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden-el'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('text-blue-600'));
            
            if(tab === 'home') {
                document.getElementById('tab-home').classList.remove('hidden-el');
                document.querySelector('.nav-item:nth-child(1)').classList.add('text-blue-600');
            } else if(tab === 'thailao' || tab === 'chinalao') {
                activeSheet = tab === 'thailao' ? 'data1' : 'data2';
                currentStatus = 'ທັງໝົດ';
                document.getElementById('logTitle').innerText = tab === 'thailao' ? 'ລາຍການ ໄທ-ລາວ' : 'ລາຍການ ຈີນ-ລາວ';
                document.getElementById('tab-logistics').classList.remove('hidden-el');
                const idx = tab === 'thailao' ? 2 : 4;
                document.querySelector(`.nav-item:nth-child(${idx})`).classList.add('text-blue-600');
                renderLogisticsList();
            } else if(tab === 'profile') {
                document.getElementById('tab-profile').classList.remove('hidden-el');
                document.querySelector('.nav-item:nth-child(5)').classList.add('text-blue-600');
            }
        }

        //count 0-100
function simulateProgress() {
            let p = 0;
            const label = document.getElementById('progressLabel');
            const interval = setInterval(() => {
                p += Math.floor(Math.random() * 20);
                if(p >= 100) {
                    label.innerText = "100%";
                    clearInterval(interval);
                } else {
                    label.innerText = p + "%";
                }
            }, 100);
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden-el');
        }

        function formatDrive(url) {
            if(!url || !url.includes('drive.google.com')) return null;
            const id = url.match(/[-\w]{25,}/);
            return id ? `https://lh3.googleusercontent.com/d/${id[0]}` : null;
        }

        function previewImg(url) {
            const src = formatDrive(url);
            if(!src) return;
            document.getElementById('previewImgEl').src = src;
            document.getElementById('imgPreviewModal').classList.remove('hidden-el');
        }




//Functio Slider ແລະ ດຶ້ງຂໍ້ມູນມາສະແດງ

                          function renderHome() {
                      // 1. Update Statistics (Thai & China Data)
                      const myThai = dataStore.data1.filter(d => d.phone == user.phone);
                      const myChina = dataStore.data2.filter(d => d.phone == user.phone);
                      
                      const statThaiEl = document.getElementById('statThai');
                      const statChinaEl = document.getElementById('statChina');
                      
                      if (statThaiEl) statThaiEl.innerText = myThai.length;
                      if (statChinaEl) statChinaEl.innerText = myChina.length;

                      // 2. Setup Slider Elements
                      const slider = document.getElementById('photoSlider');
                      const dots = document.getElementById('sliderDots');
                      if (!slider || !dots) return;

                      // 3. Filter Photo Data
                      const photoList = (dataStore.photos || []).filter(p => {
                          const link = p.url || p.image || p.link || p.photo;
                          return link && link.toString().trim() !== "";
                      });

                      // 4. Handle Empty Photo State
                      if (photoList.length === 0) {
                          slider.innerHTML = `<div class="bg-gray-100 w-full h-full flex items-center justify-center">ບໍ່ມີຮູບ</div>`;
                          dots.innerHTML = '';
                          return;
                      }

                      // 5. Render Slider Images
                      slider.innerHTML = photoList.map(p => {
                          const src = formatDrive(p.url || p.image || p.link || p.photo);
                          return `<div class="slider-item"><img src="${src}"></div>`;
                      }).join('');

                      // 6. Render Dots
                      dots.innerHTML = photoList.map(() => 
                          `<div class="dot-item w-2 h-2 rounded-full bg-white/40 transition-all"></div>`
                      ).join('');
                      
                      // 7. Manage Auto-slide Timer
                      if (typeof sliderInterval !== 'undefined') clearInterval(sliderInterval);
                      
                      sliderInterval = setInterval(() => {
                          currentSlide = (currentSlide + 1) % photoList.length;
                          updateSliderUI();
                      }, 5000); 
                      
                      // Initial UI Update
                      updateSliderUI(); 
                  }

                  // Keep this function separate for reuse by the interval
                  function updateSliderUI() {
                      const slider = document.getElementById('photoSlider');
                      if (slider) slider.style.transform = `translateX(-${currentSlide * 100}%)`;
                      
                      const dots = document.querySelectorAll('#sliderDots .dot-item .dot-shape');
                      dots.forEach((d, i) => {
                          if (i === currentSlide) {
                              d.classList.add('bg-white', 'w-6');
                              d.classList.remove('bg-white/40');
                          } else {
                              d.classList.remove('bg-white', 'w-6');
                              d.classList.add('bg-white/40');
                          }
                      });
                  }
                  


         function calculateDaysArrived(dateArrived) {
            if(!dateArrived) return 0;
            const arrived = new Date(dateArrived);
            if(isNaN(arrived.getTime())) return 0;
            const now = new Date();
            const diffTime = Math.abs(now - arrived);
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }

        function filterByStatus(status) {
            currentStatus = status;
            renderLogisticsList();
        }

        function renderLogisticsList() {
            const list = document.getElementById('logisticsList');
            let myData = dataStore[activeSheet].filter(d => d.phone == user.phone);
            
    // --- ส่วนที่แก้ไข: เรียงลำดับตามวันที่สั่งซื้อล่าสุดก่อน (Descending Order) ---
    myData.sort((a, b) => {
        // สร้าง Date Object และดึงค่า Time (ms) ออกมาเปรียบเทียบ
        const dateA = a.date_ordered ? new Date(a.date_ordered).getTime() : 0;
        const dateB = b.date_ordered ? new Date(b.date_ordered).getTime() : 0;
        
        // เรียงจากมากไปน้อย (B - A) เพื่อให้วันที่ใหม่กว่า (ค่าตัวเลขมากกว่า) ขึ้นก่อน
        return dateB - dateA;
    });
    // ----------------------------------------------------------------------
            const counts = {
                all: myData.length,
                ship: myData.filter(d => d.status === 'ກຳລັງຈັດສົ່ງ').length,
                dest: myData.filter(d => d.status === 'ຮອດປາຍທາງແລ້ວ').length,
                done: myData.filter(d => d.status === 'ສຳເລັດ').length
            };

            document.getElementById('btn-all').innerText = `ທັງໝົດ (${counts.all})`;
            document.getElementById('btn-ship').innerText = `ກຳລັງຈັດສົ່ງ (${counts.ship})`;
            document.getElementById('btn-dest').innerText = `ຮອດປາຍທາງແລ້ວ (${counts.dest})`;
            document.getElementById('btn-done').innerText = `ສຳເລັດ (${counts.done})`;

            document.querySelectorAll('.status-btn').forEach(b => b.classList.remove('status-badge-active'));
            const btnMap = { 'ທັງໝົດ': 'btn-all', 'ກຳລັງຈັດສົ່ງ': 'btn-ship', 'ຮອດປາຍທາງແລ້ວ': 'btn-dest', 'ສຳເລັດ': 'btn-done' };
            document.getElementById(btnMap[currentStatus]).classList.add('status-badge-active');

            const filtered = currentStatus === 'ທັງໝົດ' ? myData : myData.filter(d => d.status === currentStatus);

            if(filtered.length === 0) {
                list.innerHTML = `<div class="text-center py-10 text-gray-400 text-sm">ບໍ່ທັນມີຂໍ້ມູນສັ່ງເຄື່ອງ</div>`;
                return;
            }

            list.innerHTML = filtered.map(item => {
                const imgSrc = formatDrive(item.img);
                const daysAtDest = calculateDaysArrived(item.date_arrived);

                return `
                    <div onclick="showDetail('${item.tracking}')" class="bg-white p-5 rounded-[2rem] shadow-sm border border-gray-100 flex items-center gap-4 active:scale-[0.98] transition-all">
                        <div class="w-16 h-16 bg-gray-50 rounded-2xl flex-shrink-0 overflow-hidden border border-gray-100 flex items-center justify-center">
                            ${imgSrc ? `<img src="${imgSrc}" class="w-full h-full object-cover">` : `<i class="fas fa-image text-gray-300"></i>`}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start mb-1">
                                <h4 class="text-xs font-bold text-blue-600 truncate mr-2">${item.tracking}</h4>
                                <span class="text-[9px] px-2 py-0.5 rounded-full font-bold whitespace-nowrap ${statusStyle(item.status)}"> ${item.status}</span>
                            </div>
                            <p class="text-sm font-semibold text-gray-800 truncate">ສິນຄ້າ: ${item.product || 'ບໍ່ລະບຸຊື່ສິນຄ້າ'}</p>
                            ${item.status !== 'ສຳເລັດ' ? `<p class="text-[10px] text-orange-400 truncate mt-1"> ${item.detail}</p>` : ''}
                          ${item.status === 'ສຳເລັດ'? `<p class="text-[10px] text-green-500 truncate mt-1">ສຳເລັດ ${formatDateOnly(item.date_success)}</p>` 
                                : item.status !== 'ສຳເລັດ' 
                                    ? `<p class="text-[10px] text-gray-400 truncate mt-1">ສັ່ງຊື້ ${formatDateOnly(item.date_ordered)}</p>` 
                                    : `<p class="text-[10px] text-red-400 truncate mt-1">ສະຖານະອື່ນໆ</p>`
                            }
                           
                         ${item.status === 'ຮອດປາຍທາງແລ້ວ' ? `<span class="text-[9px] px-2 py-0.5 rounded-full font-bold whitespace-nowrap ${statusStyle(daysAtDest)}"> ຮອດແລ້ວ ${daysAtDest} ວັນ</span>` : ''}




                        </div>
                    </div>
                `;
            }).join('');
        }

        function statusStyle(s) {
            if(s === 'ສຳເລັດ') return 'bg-green-100 text-green-600';
            if(s === 'ກຳລັງຈັດສົ່ງ') return 'bg-red-100 text-red-600';
            if(s === 'ຮອດປາຍທາງແລ້ວ') return 'bg-orange-100 text-orange-600';
            return 'bg-orange-100 text-orange-600';
        }

        function showDetail(tracking) {
            const item = dataStore[activeSheet].find(d => d.tracking === tracking);
            const body = document.getElementById('detailBody');
            const imgSrc = formatDrive(item.img);
            
            const timelineSteps = [
                { id: 'O', label: 'ຮັບສິນຄ້າສຳເລັດ', date: item.date_success, icon: 'fa-circle-check', color: 'text-green-500' },
                { id: 'N', label: 'ສິນຄ້າຮອດປາຍທາງແລ້ວສາມາດຮັບເຄື່ອງໄດ້ເລີຍ', date: item.date_arrived, icon: 'fa-box-open', color: 'text-orange-500' },
                { id: 'M', label: 'ສິນຄ້າຮອດສູນຄັດແຍກນະຄອນຫຼວງ ກຳລັງຈັດສົ່ງໄປສາຂາປາຍທາງ', date: item.date_transit, icon: 'fa-truck-arrow-right', color: 'text-blue-500' },
                { id: 'L', label: 'ຮັບເຄື່ອງແລ້ວ ກຳລັງຈັດສົ່ງໄປລາວ', date: item.date_received_sys, icon: 'fa-barcode', color: 'text-blue-400' },
                { id: 'K', label: 'ກຳລັງຈັດສົ່ງໃນປະເທດຕົ້ນທາງ', date: item.date_shipping_origin, icon: 'fa-plane-up', color: 'text-indigo-400' },
                { id: 'J', label: 'ສັ່ງຊື້ສຳເລັດ', date: item.date_ordered, icon: 'fa-cart-shopping', color: 'text-gray-400' }
            ];

            const timelineHtml = timelineSteps.map(step => {
                if(!step.date) return '';
                return `
                    <div class="flex gap-4 group">
                        <div class="flex flex-col items-center">
                            <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center ${step.color} shadow-sm border border-gray-100">
                                <i class="fas ${step.icon} text-sm"></i>
                            </div>
                            <div class="w-0.5 h-10 bg-gray-100 group-last:hidden"></div>
                        </div>
                        <div class="pt-1">
                            <p class="text-sm font-bold text-gray-700">${step.label}</p>
                            <p class="text-[11px] text-gray-400">${formatDateOnly(step.date)}</p>
                        </div>
                    </div>
                `;
            }).join('');

            body.innerHTML = `
                <!-- รูปภาพสินค้าแบบเต็มความกว้าง -->
                <div class="detail-img-container bg-gray-50 rounded-3xl overflow-hidden border border-gray-100 flex items-center justify-center">
                    ${imgSrc ? 
                        `<img src="${imgSrc}" onclick="previewImg('${item.img}')" class="w-full h-full object-contain cursor-zoom-in">` : 
                        `<div class="flex flex-col items-center py-20 text-gray-400">
                            <i class="fas fa-file-image text-5xl mb-3"></i>
                            <p class="text-sm font-medium">ບໍ່ທັນໄດ້ບິນຮັບເຄື່ອງເທື່ອ</p>
                        </div>`
                    }
                </div>

                <!-- ข้อมูลสรุป -->
                <div class="space-y-4 pt-2">
                    <div class="p-5 bg-blue-50/50 rounded-3xl border border-blue-100">
                        <p class="text-[10px] text-blue-400 uppercase font-bold tracking-widest mb-1">ເລກ Tracking</p>
                        <p class="text-2xl font-bold text-blue-600 tracking-tight">${item.tracking}</p>
                    </div>

                    <div class="grid grid-cols-1 gap-3">
                        <div class="p-4 bg-gray-50 rounded-2xl border border-gray-100">
                            <p class="text-[10px] text-gray-400 font-bold mb-1">ຊື່ສິນຄ້າ</p>
                            <p class="text-sm font-semibold text-gray-800">${item.product || '-'}</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-2xl border border-gray-100">
                            <p class="text-[10px] text-gray-400 font-bold mb-1">ລາຍລະອຽດຈັດສົ່ງ</p>
                            <p class="text-sm font-semibold text-gray-800">${item.detail || '-'}</p>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="pt-6 border-t border-gray-100">
                    <h4 class="text-sm font-bold text-gray-800 mb-6 flex items-center gap-2">
                        <i class="fas fa-route text-blue-500"></i>ສະຖານະຕິດຕາມ
                    </h4>
                    <div class="space-y-0">
                        ${timelineHtml || '<p class="text-center text-gray-400 text-xs py-4">ຍັງບໍ່ມີສະຖານະອັບເດດ</p>'}
                    </div>
                </div>

           

                ${item.status == 'ຮອດປາຍທາງແລ້ວ' ? `
                    <button onclick="confirmReceived('${item.tracking}')" class="w-full py-5 bg-blue-600 text-white rounded-3xl font-bold text-lg shadow-xl shadow-green-100 active:scale-95 transition-all mt-4">
                        <i class="fas fa-check-circle mr-2"></i>ຢືນຢັນຮັບສິນຄ້າ
                    </button>
                ` : ''}
            `;
            document.getElementById('detailModal').classList.remove('hidden-el');
        }
        
        async function confirmReceived(tracking) {
    // 1. Show the SweetAlert confirmation dialog
    const result = await Swal.fire({
        title: 'ຢືນຢັນຮັບສິນຄ້າ?',
        text: "ຖ້າທ່ານໄດ້ຮັບແລ້ວ ລົບກວນກົດທີ່ຢືນຢັນ",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#1E61ED',
        cancelButtonColor: '#d33',
        confirmButtonText: 'ຮັບແລ້ວ',
        cancelButtonText: 'ຍົກເລີກ'
    });

    // 2. Check if the user clicked "Confirm"
    if (result.isConfirmed) {
        const res = await api('markSuccess', { sheet: activeSheet, tracking: tracking });

        if (res.status === 'success') {
            // 3. Show a success message
            await Swal.fire({
                title: 'ສຳເລັດ!',
                text: 'ຮັບສິນຄ້າສຳເລັດແລ້ວ',
                icon: 'success',
                timer: 2000, // Auto close after 2 seconds
                showConfirmButton: false
            });

            closeModal('detailModal');
            await refreshData();
            renderLogisticsList();
        } else {
            // Optional: Handle error
            Swal.fire('เกิดข้อผิดพลาด', 'ไม่สามารถบันทึกข้อมูลได้', 'error');
        }
    }
}    




//.................................................................................................................


        function updateProfileUI() {
 
            document.getElementById('userNameDisplay').innerText = user.name;
            document.getElementById('userPhoneDisplay').innerText = user.phone;
        }

        // function formatDateOnly(dStr) {
        //     if(!dStr) return '-';
        //     try {
        //         const d = new Date(dStr);
        //         if(isNaN(d.getTime())) return dStr;
        //         // รูปแบบ dd/mm/yyyy
        //         const day = String(d.getDate()).padStart(2, '0');
        //         const month = String(d.getMonth() + 1).padStart(2, '0');
        //         const year = d.getFullYear() + 543; // พ.ศ.
        //         return `${day}/${month}/${year}`;
        //     } catch(e) { return dStr; }
        // }

        function formatDateOnly(dStr) {
    if(!dStr) return '-';
    try {
        const d = new Date(dStr);
        if(isNaN(d.getTime())) return dStr;

        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear(); // ปี พ.ศ.
        // const year = d.getFullYear() + 543; // ปี พ.ศ.
        
        // เพิ่มส่วนของเวลา
        const hours = String(d.getHours()).padStart(2, '0');
        const minutes = String(d.getMinutes()).padStart(2, '0');

        return `ວັນທີ ${day}/${month}/${year}  ເວລາ ${hours}:${minutes}`;
    } catch(e) { 
        return dStr; 
    }
}

        function togglePassword(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        


        
        // Profile Modals
        function openEditNameModal() {
            const modal = document.getElementById('inputModal');
            document.getElementById('modalTitle').innerText = "ແກ້ໄຂຊື່ຜູ້ໃຊ້";
            const content = document.getElementById('modalContent');
            content.innerHTML = `<input type="text" id="newNameInput" value="${user.name || ''}" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="ระบุชื่อของคุณ">`;
            
            const btn = document.getElementById('modalConfirmBtn');
            btn.onclick = async () => {
                const val = document.getElementById('newNameInput').value;
                

                // 1. Check if the value is empty
    if (val === "") {
        // Optional: Alert the user that the name cannot be empty
        Swal.fire({
            title: 'ບໍ່ທັນໃສ່ຊື່່!',
            text: 'ກະລຸນາລະບຸຊື່ຂອງທ່ານ ເພື່ອປ່ຽນຊື່ຜູ້ໃຊ້',
            icon: 'warning',
            confirmButtonText: 'ຕົກລົງ'
        });
        return; 
    }

    // 2. Check if the value is the same as the current name (no change)
    if (val === user.name) {
        // Optional: Close modal or just return since nothing changed
        Swal.fire({
            title: 'ແຈ້ງເຕືອນ!',
            text: 'ກະລຸນາລະບຸຊື່ຂອງທ່ານ',
            icon: 'warning',
            confirmButtonText: 'ຕົກລົງ'
        });
        return;
    }

                const res = await api('updateProfile', { phone: user.phone, name: val });
                if(res.status === 'success') {
                    user.name = val;
                    localStorage.setItem('banhom_session', JSON.stringify(user));
                    updateProfileUI();      
                     await Swal.fire({
                title: 'ສຳເລັດ!',
                text: 'ປ່ຽນຊື່ສຳເລັດແລ້ວ',
                icon: 'success',
                timer: 2000, // Auto close after 2 seconds
                showConfirmButton: false
            });      
                    
                    closeModal('inputModal');
                }
            };
            modal.classList.remove('hidden-el');





        }



      function openChangePassModal() {
    const modal = document.getElementById('inputModal');
    document.getElementById('modalTitle').innerText = "ປ່ຽນລະຫັດຜ່ານ";
    const content = document.getElementById('modalContent');
    content.innerHTML = `
        <input type="password" id="p1" class="w-full p-4 bg-gray-50 border rounded-2xl mb-2" placeholder="ລະຫັດຜ່ານໃໝ່">
        <input type="password" id="p2" class="w-full p-4 bg-gray-50 border rounded-2xl" placeholder="ຢືນຢັນລະຫັດຜ່ານໃໝ່">
    `;
    
    const btn = document.getElementById('modalConfirmBtn');
    btn.onclick = async () => {
        const v1 = document.getElementById('p1').value;
        const v2 = document.getElementById('p2').value;

        // 1. Check if the value is empty
        if (v1 === "" || v2 === "") {
            Swal.fire({
                title: 'ແຈ້ງເຕືອນ!',
                text: 'ກະລຸນາໃສ່ລະຫັດຜ່ານ',
                icon: 'warning',
                confirmButtonText: 'ຕົກລົງ'
            });
            return;
        }

        // 2. Check if the passwords match
        if (v1 !== v2) {
            Swal.fire({
                title: 'ແຈ້ງເຕືອນ!',
                text: 'ລະຫັດຜ່ານບໍ່ກົງກັນ',
                icon: 'warning',
                confirmButtonText: 'ຕົກລົງ'
            });
            return;
        }


        if(v1.length < 5 || v2.length < 5) return Swal.fire({ // ປ່ຽນເປັນ 5 ຕາມທີ່ text ບອກ
          icon: "error",
          title: "ລະຫັດຜ່ານສັ້ນເກີນໄປ",
          text: "ກະລຸນາໃສ່ລະຫັດຜ່ານຢ່າງນ້ອຍ 5 ຕົວເລກ",
    });

        // --- NEW SECTION: 3. Block weak sequential passwords ---
        const forbiddenPasswords = ["123", "1234", "12345", "123456", "1234567", "12345678", "123456789"];
        if (forbiddenPasswords.includes(v1)) {
            Swal.fire({
                title: 'ລະຫັດຜ່ານບໍ່ປອດໄພ!',
                text: 'ກະລຸນາຢ່າໃຊ້ລະຫັດຜ່ານທີ່ງ່າຍເກີນໄປ (ເຊັ່ນ: 123456)',
                icon: 'error',
                confirmButtonText: 'ຕົກລົງ'
            });
            return;
        }
        // -------------------------------------------------------

        const res = await api('updatePassword', { phone: user.phone, newPass: v1 });

        if (res.status === 'success') {
            closeModal('inputModal');
            await Swal.fire({
                title: 'ສຳເລັດ!',
                text: 'ປ່ຽນລະຫັດຜ່ານສຳເລັດແລ້ວ',
                icon: 'success',
                timer: 2000,
                showConfirmButton: false
            });
        } else {
            Swal.fire('ຜິດພາດ', 'ບໍ່ສາມາດປ່ຽນລະຫັດຜ່ານໄດ້', 'error');
        }
    };

    modal.classList.remove('hidden-el');
}

       

        function formatDate(dStr) {
            if(!dStr) return '-';
            try {
                const d = new Date(dStr);
                if(isNaN(d.getTime())) return dStr;
                return d.toLocaleDateString('th-TH', { 
                    day: '2-digit', month: 'short', year: 'numeric', 
                    hour: '2-digit', minute: '2-digit' 
                });
            } catch(e) { return dStr; }
        }

        
    
function confirmLogout() {
    Swal.fire({
        title: 'ອອກລະບົບ?',
        text: "ທ່ານຕ້ອງການອອກລະບົບແທ້ບໍ?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444', // สีแดง
        cancelButtonColor: '#94a3b8',
        confirmButtonText: 'ອອກລະບົບ',
        cancelButtonText: 'ຍົກເລີກ'
    }).then((result) => {
        if (result.isConfirmed) {
            // โค้ดสำหรับออกจากระบบ
            logout(); 
        }
    });
}


function confirmR() {
    Swal.fire({
        title: 'ຢືນຢັນຮັບສິນຄ້າ?',
        text: "คແນ່ໃຈແລ້ວບໍຖ້າທ່ານກົດ ຢືນຢັນ ຫໝາຍຄວາມວ່າຮັບສິນຄ້າແລ້ວ?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444', // สีแดง
        cancelButtonColor: '#94a3b8',
        confirmButtonText: 'ຢືນຢັນ',
        cancelButtonText: 'ຍົກເລີກ'
    }).then((result) => {
        if (result.isConfirmed) {
            // โค้ดสำหรับออกจากระบบ
            logout(); 
        }
    });
}



    </script>
</body>
</html>